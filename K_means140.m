%% 设置地面大小和高度
ground_size = [500, 500];%长1000米 宽1000米
ground_height = 100;%空间高100米
%% 随机生成140个地面用户的位置
user_num = 140;
% user_pos = (rand(2, user_num) .* repmat([ground_size]', 1, user_num))';%随机生成140个坐标 然后转置
user_pos = [342,334;387,413;489,127;56,357;442,376;288,298;357,420;492,448;14,424;4,334;203,338;490,468;83,257;
            382,19;372,409;480,333;344,173;443,168;373,299;4,255;231,268;72,454;349,373;400,458;50,29;100,484;
            70,18;84,113;274,108;127,351;306,255;385,392;119,391;338,58;269,13;485,173;34,450;212,45;408,243;
            172,310;38,446;438,422;21,4;214,301;429,340;206,66;309,428;364,99;222,435;16,153;36,222;83,66;
            446,447;498,121;62,343;66,33;362,4;247,435;210,427;335,373;334,180;473,217;78,417;104,286;
            461,442;273,315;302,391;130,42;237,189;149,199;269,188;273,265;165,196;389,196;106,283;
            273,121;168,430;285,34;261,47;386,143;330,42;463,265;336,470;55,183;96,198;372,12;
            197,412;401,176;447,70;416,258;102,84;423,328;304,392;13,394;421,105;115,219;399,423;
            449,231;174,8;377,344;435,91;344,352;242,99;374,168;118,291;446,410;36,87;369,58;
            21,275;225,138;48,383;103,32;166,425;266,366;163,124;61,87;427,186;208,228;400,497;
            100,320;400,10;166,219;289,351;256,233;453,117;364,156;429,449;156,296;273,460;114,232;
            453,242;443,19;262,312;263,195;494,39;112,269;486,485;134,471;497,438;259,445];%固定140个用户坐标点
user_pos(3,:)=0; %用户高为0         
%% 用户优先级模型  用户第4列
i = user_num;
EimaxlowerLimit = 1.17;  %wh 
EimaxupperLimit = 3.5;     %wh
Eimax = [EimaxlowerLimit + (EimaxupperLimit- EimaxlowerLimit) * rand(1, i)]';%用户最大能量
%随机生成的一组固定值
% Eimax=[2.93517028121099;1.34290982440821;2.15329471176300;1.42922764704085;3.45514893091329;2.31272310265523;2.94046755903573;2.09625325525122;2.08925933811067;2.59000315639579;3.41827515026984;1.73866413168315;3.13487352481834;1.62977290790511;
%        2.05410018353460;3.47481168080594;1.65089926066062;1.71886596956072;2.96836481736904;2.51373897446842;1.56281330003100; 1.93394620868453;1.78137249195144;1.63087506165020;3.45603623535475;2.50835540193902;2.55667899654791;2.54598804607445;
%        2.90689894365018;2.62403373255105;1.75475798393502;1.80858248073928;3.49413214983214;1.40575961037883;1.47326461677357;2.84247702883189;3.10870909774437;2.46294879386184;2.20439741743324;2.44516582725020;3.28475947916424;2.90724059566125;
%        2.70817339195218;1.46375355006352;2.15073156224668;3.15951721168280;2.92234101546243;2.79971702404649;1.77393353121784; 3.19200220696154;2.41524934458998;1.64774545876828;1.23023951474150;2.68600485504220;1.63212943645198;3.03661608491665;
%        2.77539480085773;3.10411443435010;2.99884680001530;2.79851165841766;3.24963947917400;1.73962756362808;1.57429172971673; 2.49512015084775;3.03157165155909;2.45331416429649;1.68277789434003;1.90381507087978;1.37508132467314;1.84670710733308;
%        1.67015340453022;1.43641170434654;2.35373906464053;2.15803819343643;2.47485094065287;1.53269715311434;1.50421331845693;1.19258201375388;3.13690443143284;3.29760291544317;2.91242266664366;2.45451588495265;1.97030823681482;1.39395240318732;
%        1.28123491412413;1.94299750007326;3.38054732724105;1.82175560898172;2.47633502158297;1.38411065438071;3.38897300126461;2.34345699699688;1.90774549128876;2.42828378642523;3.45025149569743;1.72437984532978;1.95432826418587;2.03984947201094;
%        2.15831008470681;1.93731392342282;2.72649432204800;2.17477689237854;2.38165992469826;2.80188639583402;2.50946580823700;2.03228019733221;3.06029778270361;2.18555727906555;1.46246017019596;1.43594469745239;2.28321915801363;3.07398564631286;
%        2.99434212838050;3.37779610215080;3.12889658552001;2.66064057288977;1.41060978461564;2.10609503398329;1.26912872631918;2.04200051762758;1.89710198295661;2.36839571682600;1.32338300777509;1.54257388006728;3.12747827144151;3.36201311913396;
%        2.15523776659030;2.81255185658762;2.35156898830547;1.82908683701332;1.82361121839874;1.59292447932319;2.77394682082017;2.82343619348492;2.20059481707167;2.07541755910253;1.38641209585687;1.61444827340811;1.90206372773007;3.29507670282290];
Eimax= round(Eimax, 2);%保留两位小数
Eimax=[1.24000000000000;2.52000000000000;2.29000000000000;1.82000000000000;2.50000000000000;1.38000000000000;3.20000000000000;2.29000000000000;1.73000000000000;2.20000000000000;1.20000000000000;1.62000000000000;3;3.02000000000000;2.27000000000000;1.49000000000000;3.42000000000000;3.20000000000000;2.97000000000000;3.12000000000000;1.34000000000000;2.15000000000000;3.02000000000000;1.54000000000000;2.92000000000000;1.48000000000000;2.61000000000000;3.28000000000000;1.26000000000000;1.71000000000000;2.26000000000000;2.87000000000000;2.16000000000000;1.58000000000000;2.64000000000000;2.39000000000000;1.94000000000000;1.19000000000000;1.28000000000000;2.34000000000000;1.35000000000000;1.90000000000000;1.98000000000000;1.73000000000000;2.05000000000000;3.32000000000000;3.09000000000000;1.64000000000000;2.54000000000000;3.03000000000000;2.20000000000000;1.80000000000000;1.72000000000000;2.36000000000000;1.58000000000000;2.69000000000000;1.66000000000000;2.52000000000000;2.07000000000000;2.25000000000000;1.33000000000000;1.32000000000000;2.58000000000000;2.76000000000000;1.46000000000000;1.19000000000000;2.38000000000000;2.73000000000000;1.52000000000000;3.38000000000000;2.13000000000000;2.76000000000000;2.94000000000000;2.84000000000000;1.84000000000000;1.90000000000000;1.82000000000000;3.29000000000000;1.34000000000000;2.54000000000000;2.76000000000000;2.14000000000000;1.24000000000000;1.40000000000000;1.65000000000000;3.41000000000000;2.75000000000000;2.32000000000000;1.58000000000000;2.71000000000000;3.18000000000000;1.94000000000000;2.19000000000000;1.39000000000000;2.73000000000000;1.91000000000000;1.76000000000000;2.17000000000000;3.04000000000000;2.97000000000000;2.99000000000000;2.48000000000000;1.32000000000000;1.96000000000000;2.33000000000000;2.50000000000000;3.35000000000000;1.98000000000000;2.89000000000000;2.19000000000000;3.44000000000000;1.31000000000000;2.44000000000000;3.18000000000000;3.36000000000000;1.74000000000000;2.96000000000000;2.62000000000000;2.53000000000000;2.41000000000000;2.25000000000000;1.53000000000000;2.05000000000000;3.01000000000000;3.47000000000000;1.88000000000000;2.90000000000000;2.47000000000000;2.94000000000000;1.95000000000000;2.69000000000000;1.98000000000000;1.27000000000000;1.29000000000000;3.15000000000000;3.13000000000000;2.61000000000000;2.53000000000000;1.77000000000000;2.59000000000000];

betailowerLimit=1;
betaiupperLimit=3;
betai=[betailowerLimit + (betaiupperLimit- betailowerLimit) * rand(1, i)]';%延迟容忍度
%随机生成的一组固定值
% betai=[2.31545836263911;2.99171777080997;2.98793005083956;1.05198228920353;2.25089162996135;2.62879920686335;2.54628251459999;2.61434386737299;2.03838522551489;2.30098133212640;2.96468635316778;2.34254800199076;2.98873830833367;1.68778836493810;2.15736610986088;2.47071122484744;2.24816626898645;2.04194947475038;2.22729047182728;2.70181433933587;2.03533364371985;1.42075718036868;2.70728921853862;2.88738284165453;1.69106285057292;1.50376421649652;2.48216484750924;2.86767859008316;1.85270221367247;2.44670838417960;2.41261753518207;1.35334844777741;1.25688640601996;1.77403343778448;2.86170678557225;1.28941944684128;2.69214358660033;2.22451435702832;2.28258058069548;2.20898124742642;1.70575941434165;1.54359229790779;2.38132100199087;1.11975549025486;2.45101313086318;1.77752997525041;1.89165625101173;2.17760420820071;2.87118169090191;1.03428564886734;1.51466123138763;1.16615925435705;1.64912302798350;2.06585045817160;2.04942786911002;1.23247911617571;1.87533852015866;2.83204160431285;2.80453802160078;1.91839170316743;2.71936388690949;2.94701935347971;2.03641020165704;2.74878737058819;2.86987536557078;1.61977539043391;2.48498416751040;1.57200789682967;2.76799643395872;2.87113288954746;2.80344765920503;1.09926963956457;1.28379000587105;1.16164228817721;2.52968001141028;1.50626427086154;1.78111574871968;2.83354222826263;1.41989186357413;2.84635135430531;2.39124145170229;1.21551861606808;2.43749431253215;1.05162647151789;2.75973352392042;1.42751935945165;2.27742909873550;1.15503858312262;2.11840170772144;1.20929447316561;2.31279750176413;1.67084932145078;2.27331472371811;2.93069984750368;2.55604619666712;1.06801028765989;2.57315695038187;2.92067292597071;1.56474678274753;1.59769804959906;1.76365929468069;2.75144601821662;2.77754981277109;1.59105654319040;1.68784547244266;1.16249034265373;2.85067588378186;1.56769472329497;2.10161176090818;2.94043713254633;1.72299307369295;1.58508722382806;2.63372067497920;1.07414122757076;2.79781244557799;2.11343575002983;1.23176547205531;2.66664799708673;2.97150489467176;1.47936251777175;2.46704472177269;2.88189580395777;2.79646268263314;1.14815876608888;2.55145736402490;2.84413336298966;2.64505546866242;2.00873286622122;1.43242171977600;1.51120798175475;2.92470267345101;1.18698630683666;1.53489843886906;1.52573080826471;2.79603844486673;2.35828672934980;1.87158933263359;2.37545775611213;1.58317827184235;2.74856480357878];
betai= round(betai, 2);%保留两位小数
betai=[1.35000000000000;2.36000000000000;2.39000000000000;2.42000000000000;1.13000000000000;2.45000000000000;2.90000000000000;2.20000000000000;1.30000000000000;1.86000000000000;2.34000000000000;2.88000000000000;2.41000000000000;2.61000000000000;1.90000000000000;1.81000000000000;1.81000000000000;1.39000000000000;1.79000000000000;2.56000000000000;1.66000000000000;1.17000000000000;2.55000000000000;1.14000000000000;1.23000000000000;2.19000000000000;2.74000000000000;1.57000000000000;1.27000000000000;2;1.43000000000000;1.18000000000000;1.74000000000000;1.87000000000000;2.96000000000000;1.67000000000000;2.38000000000000;2.64000000000000;1.96000000000000;1.22000000000000;1.47000000000000;2.04000000000000;3;2.60000000000000;2.55000000000000;2.44000000000000;1.38000000000000;1;2.77000000000000;2.89000000000000;1.66000000000000;2.62000000000000;2.22000000000000;2.79000000000000;2.16000000000000;1.28000000000000;2.91000000000000;1.19000000000000;1.87000000000000;1.58000000000000;1.74000000000000;1.66000000000000;2.78000000000000;1.02000000000000;1.89000000000000;2.94000000000000;2.42000000000000;1.82000000000000;2.45000000000000;1.21000000000000;1.37000000000000;1.35000000000000;2.10000000000000;2.56000000000000;1.49000000000000;2.26000000000000;2.20000000000000;2.96000000000000;2.96000000000000;1.93000000000000;1.82000000000000;2.05000000000000;2.39000000000000;1.41000000000000;1.19000000000000;2.14000000000000;2.22000000000000;1.63000000000000;1.40000000000000;2.43000000000000;2.88000000000000;2.62000000000000;1.73000000000000;1.26000000000000;1.75000000000000;1.48000000000000;2.82000000000000;2.70000000000000;1.17000000000000;2.87000000000000;1.68000000000000;2.44000000000000;2.49000000000000;1.06000000000000;2.55000000000000;1.13000000000000;1.67000000000000;1.49000000000000;2.35000000000000;2.37000000000000;1.76000000000000;1.83000000000000;1.85000000000000;2.50000000000000;1.78000000000000;1.66000000000000;2.07000000000000;1.69000000000000;2.47000000000000;1.74000000000000;2.55000000000000;2.35000000000000;1.73000000000000;1.11000000000000;2.36000000000000;1.26000000000000;2.65000000000000;2.36000000000000;1.87000000000000;2.92000000000000;1.45000000000000;2.53000000000000;2.09000000000000;1.49000000000000;2.29000000000000;1.88000000000000;2.95000000000000;1.76000000000000;2.75000000000000;1.57000000000000];

% TilowerLimit=5;%选取这组数满意度较小
% TiupperLimit=10;
% Ti=[TilowerLimit + (TiupperLimit- TilowerLimit) * rand(1, i)]';%理想可容忍延迟
% Ti=[5.65000000000000;7.65000000000000;9.56000000000000;6.12000000000000;9.43000000000000;6.33000000000000;6.60000000000000;5.03000000000000;5.51000000000000;9.16000000000000;8.14000000000000;7.99000000000000;6.11000000000000;5.56000000000000;5.48000000000000;5.30000000000000;7.59000000000000;7.21000000000000;5.34000000000000;9.19000000000000;5.99000000000000;6.17000000000000;7.57000000000000;8.28000000000000;9.14000000000000;8.59000000000000;6.74000000000000;5.48000000000000;7.82000000000000;9.97000000000000;6.97000000000000;8.83000000000000;8.94000000000000;5.35000000000000;6.92000000000000;9;6.59000000000000;9.58000000000000;9.78000000000000;9.20000000000000;7.16000000000000;9.85000000000000;9.93000000000000;6.23000000000000;5.23000000000000;9.07000000000000;6.99000000000000;9.05000000000000;9.38000000000000;6.95000000000000;9.74000000000000;5.05000000000000;9.77000000000000;8.20000000000000;9.46000000000000;6.19000000000000;5.62000000000000;8.15000000000000;6.73000000000000;7.62000000000000;5.60000000000000;6;8.50000000000000;9.18000000000000;9.65000000000000;8.53000000000000;8.79000000000000;9.84000000000000;7.40000000000000;5.61000000000000;8.20000000000000;9.26000000000000;6.13000000000000;8.39000000000000;9.98000000000000;5.57000000000000;6.27000000000000;9.76000000000000;8.86000000000000;5.08000000000000;7.69000000000000;9.92000000000000;7.71000000000000;5.30000000000000;8.40000000000000;6.15000000000000;7.97000000000000;5.70000000000000;5.34000000000000;5.72000000000000;8.57000000000000;8.24000000000000;5.84000000000000;9.91000000000000;9.96000000000000;7.29000000000000;5.76000000000000;8.91000000000000;7.95000000000000;8.09000000000000;8.09000000000000;5.63000000000000;8.85000000000000;7.29000000000000;8.56000000000000;7.75000000000000;8.25000000000000;8.02000000000000;9.77000000000000;5.28000000000000;7.13000000000000;9.68000000000000;6.55000000000000;8.75000000000000;8.80000000000000;5.53000000000000;8.16000000000000;7.12000000000000;6.79000000000000;7.01000000000000;5.85000000000000;5.84000000000000;6.05000000000000;8.12000000000000;7.60000000000000;5.05000000000000;9.25000000000000;7.16000000000000;5.41000000000000;7.32000000000000;8.30000000000000;8.22000000000000;9.96000000000000;9.48000000000000;7.95000000000000;8.53000000000000;6.18000000000000;9.18000000000000;9.38000000000000;8.57000000000000];
TilowerLimit=10;
TiupperLimit=50;
Ti=[TilowerLimit + (TiupperLimit- TilowerLimit) * rand(1, i)]';%理想可容忍延迟
% 随机生成的一组固定值
% Ti=[18.4476274979868;38.9995740721803;18.4529800071742;15.6544492801208;44.7780657447566;15.1738157528843;17.6815062531463;44.4544214269062;12.8062690739820;48.1006777610478;39.5647605592240;26.7730140827442;37.4437505757492;27.5804757840169;30.8627816687097;37.8935538974682;10.2782239384997;30.1611415909052;32.0591957194688;28.9228438063706;42.2873896084918;33.6161447093682;41.9940739847156;47.5933528089838;41.8216736894150;16.3442961523736;14.5440513329343;41.7963339013620;29.8406051946474;15.1164745477009;49.4227875102270;43.0751067835079;30.8768191586760;13.8874406281638;17.4121939472694;41.0533884307571;19.7694003049372;24.3844093575182;28.8088756927082;42.4760116461102;32.6037065951889;13.0431579495231;24.9382658295595;37.0477927018598;41.1824319132704;26.2281636614249;14.9428178464459;20.9847391215487;42.2054066040699;35.5647865295101;44.0308222720372;28.9738648896020;13.6799494694679;43.8060192688800;12.7098579480046;25.0062186963141;17.1303931524642;49.1305484191572;32.9662059815796;20.9314928409139;20.3543642558209;23.7411729267263;10.9159940128328;27.2022177880270;13.2775392156499;27.5599215343642;36.3691471483908;19.9911354480736;18.3564531107374;17.7048242787701;27.0061507239038;41.2516023742236;39.3814106982654;16.3898308835291;43.6409699669134;41.3979232021105;43.1482668351226;13.2903796401158;28.9323572258849;25.0929065624436;42.6302420464644;20.2212013218866;35.6041960623633;43.2477053903528;46.8061753728795;30.7866062696718;14.6814324560660;27.8237484718770;34.8519493270764;25.1336691806390;16.9847319217817;25.7731337540710;18.7613467058375;48.8776266531755;12.4416080906460;21.5753024979056;10.9163678919141;28.9552189766482;36.9354411951526;49.0428501546378;21.1204305324089;32.4504401859277;28.0323196772980;24.7985979836095;13.5530214148307;45.1905644527036;46.2063721590247;15.8830090288428;38.9181596746469;25.1866037223467;26.4852521116212;29.4930317618783;35.8383879785817;49.6740989002259;27.5367368655621;10.5609020734218;46.8919826565722;27.6512148360360;30.3772613231608;12.4446369240225;45.9748406174246;16.5115322518123;17.3722314974089;42.3029909465152;36.7314285236686;21.3296310169862;28.0101008603709;44.1396383741827;20.2316268776225;46.5010456623640;19.5185814027189;43.7321586183116;41.5435715727327;45.4715927080930;45.9992086053714;42.6658826697698;30.3962856524784;16.6562029087045;25.9324744834815;24.6462379304382];
Ti= round(Ti, 2);%保留两位小数
Ti=[49.8500000000000;25.9000000000000;40.6000000000000;44.5600000000000;48.2700000000000;24.3700000000000;35.2900000000000;28.3600000000000;46.7100000000000;40.5800000000000;32.2400000000000;36.6000000000000;20.5000000000000;39.6700000000000;26.0900000000000;13.8200000000000;39.2500000000000;13.0300000000000;37.7500000000000;40.8100000000000;17.4000000000000;41.5600000000000;20.0500000000000;26.7400000000000;33.2400000000000;26.8600000000000;41.3100000000000;16.1100000000000;21.3100000000000;32.5400000000000;30.1000000000000;47.1900000000000;29.2600000000000;33.7400000000000;14.0100000000000;41.3900000000000;10.1500000000000;10.6500000000000;44.1400000000000;24.0800000000000;29.1200000000000;25.6200000000000;11.2600000000000;17.2200000000000;37.2100000000000;14.9500000000000;48.9900000000000;42.9100000000000;43.1200000000000;11.9200000000000;23.4600000000000;17.7700000000000;13;49.6500000000000;35.6000000000000;28.3100000000000;28.7000000000000;21.2900000000000;45.2800000000000;49.1300000000000;41.5200000000000;37.5300000000000;11.8800000000000;10.9200000000000;28.2900000000000;47.1000000000000;38.6900000000000;48.8500000000000;24.9100000000000;31.2500000000000;34.3100000000000;25.3400000000000;13.5000000000000;17.2000000000000;42.1000000000000;43.1000000000000;41.0200000000000;27.8400000000000;16.0400000000000;19.1300000000000;15.6300000000000;17.2100000000000;44.9900000000000;24.6100000000000;15.7500000000000;35.0700000000000;30.6900000000000;13.3400000000000;17.6200000000000;24.1000000000000;27.0300000000000;22.4700000000000;32.7800000000000;46.6900000000000;49.5000000000000;35.1300000000000;30.0700000000000;22.9600000000000;34.6400000000000;46.9400000000000;43.6300000000000;32.8300000000000;21.8500000000000;21.8500000000000;35.7000000000000;11.6800000000000;40.5000000000000;23.6600000000000;49.2900000000000;40.5000000000000;30.1300000000000;41.0500000000000;22.6100000000000;49.8700000000000;23.9200000000000;34.1400000000000;31.2500000000000;35.3200000000000;20.8200000000000;46;41.0600000000000;25.8500000000000;45.7700000000000;47.5200000000000;30.3400000000000;40.6700000000000;44.8600000000000;19.0100000000000;41.9300000000000;29.0600000000000;30.7400000000000;37.7500000000000;12.0300000000000;48.9300000000000;27.3100000000000;12.4400000000000;16.2600000000000;37.2300000000000;31.6700000000000;22.2100000000000];
% user_pos(:,8)=Ti;

TlowerLimit=100;
TupperLimit=300;
T=[TlowerLimit + (TupperLimit- TlowerLimit) * rand(1, i)]'; %服务期持续时间
%随机生成的一组固定值
% T=[291.038028567569;206.289774691259;270.131670924886;281.384878861632;296.009125786468;195.442229826418;214.831494621446;140.482274475126;113.224333836519;115.800520084388;245.118654265552;128.265421466044;211.425928640468;140.494801440384;259.380612759231;168.431520674539;105.610767980767;228.154534796724;247.905983934311;248.843892018386;216.758226134071;298.300735140533;137.476062067493;156.507408844635;264.901786750289;225.871532474721;272.513567970945;214.004829598193;288.112325609260;251.941334240858;142.264300071626;107.712562912168;162.779722971344;172.047015215572;251.491870246773;265.605119819321;119.519683436926;129.350322430473;121.716755043892;233.914768167130;128.500201169651;240.713620899799;124.789580834280;167.162594764045;240.787923397102;236.609067939992;117.474400959310;172.314748255413;280.717759135432;212.259224216986;210.110380258045;236.940706247755;173.167313185046;111.906130248218;274.977999980162;203.105266005178;258.705170486811;179.126502400336;153.587811934850;264.713575435362;293.335334700149;275.899282486859;190.944926134521;211.992119603889;112.564755163331;102.859462479484;271.800047328218;256.010574695654;110.575232690406;163.047341162358;161.832799371606;115.731700269827;150.788851944273;125.848132511278;219.602115858778;199.820595326798;229.839515778827;189.901711989520;242.861146530311;226.616102835464;113.613833426886;128.150699042592;179.703943146821;241.061020733751;184.178887820569;130.270651209750;221.503709579236;194.444026513685;152.248682043292;221.890075909120;279.979892324115;194.791795081754;135.226852201120;254.940372680491;208.467186228090;254.311444478970;265.075838256335;274.475872889367;156.250493091893;231.372918926553;121.077547236291;228.688440709802;156.518830806788;103.969409621759;226.325747911732;253.069766220292;163.507777340668;231.369463015151;210.441049047381;114.572366070947;210.345945217664;130.115870623476;145.145361391209;257.941527823527;250.728967886371;245.659403037086;117.390856498414;242.719136976938;233.599559917221;130.730642416342;108.973096867604;100.396669989781;152.850779075263;275.373179837120;151.786506642872;248.987043053460;208.838765286225;253.317706548859;111.006517273041;125.659225431333;124.895643700642;221.687588044263;152.678486785728;118.906893279985;204.493840908279;166.527739707142;182.658194342553;150.981970588078;280.482764742004;197.836030587557];
T= round(T, 2);%保留两位小数 
T=[267.870000000000;232.180000000000;153.080000000000;176.590000000000;182.970000000000;185.830000000000;121.710000000000;234.070000000000;109.500000000000;119.250000000000;252.120000000000;248.980000000000;161.470000000000;198.500000000000;141.260000000000;191.510000000000;132.760000000000;218.490000000000;166.220000000000;260.940000000000;199.290000000000;231.520000000000;284.060000000000;233.480000000000;139.950000000000;235.970000000000;226.300000000000;288.170000000000;238.650000000000;210.240000000000;168.440000000000;225.160000000000;159.940000000000;179.620000000000;247.820000000000;157.840000000000;168.220000000000;298.210000000000;246.940000000000;130.100000000000;216.100000000000;165.500000000000;262.740000000000;206.670000000000;104.860000000000;298.750000000000;186.700000000000;109.630000000000;270.560000000000;175.340000000000;213.930000000000;148.740000000000;183.790000000000;249.850000000000;225.590000000000;249.140000000000;278.320000000000;232.280000000000;178.180000000000;215.940000000000;110.300000000000;117.520000000000;191.360000000000;259.420000000000;172.400000000000;258.570000000000;221.700000000000;249.630000000000;114.300000000000;213.760000000000;162.960000000000;200.170000000000;172.650000000000;125.970000000000;216.670000000000;274.040000000000;189.160000000000;256.840000000000;178.280000000000;241.610000000000;112.200000000000;238.010000000000;112.460000000000;187.400000000000;248.880000000000;131.850000000000;145.030000000000;214.830000000000;160.060000000000;215.360000000000;177.720000000000;209.660000000000;210.470000000000;263.510000000000;211.860000000000;223.710000000000;120.390000000000;264.720000000000;164.350000000000;144.610000000000;260.440000000000;241.300000000000;294;274.210000000000;219.120000000000;120.740000000000;265.680000000000;118.200000000000;175.760000000000;101.660000000000;158.700000000000;151.430000000000;237.120000000000;245.290000000000;269.370000000000;297.890000000000;106.090000000000;136.860000000000;202.300000000000;103.050000000000;279.170000000000;136.050000000000;163.990000000000;255.480000000000;272.650000000000;259.110000000000;291.840000000000;225.770000000000;206.340000000000;222.510000000000;204.400000000000;127.940000000000;294.140000000000;138.250000000000;233.680000000000;248.680000000000;192.370000000000;157.940000000000;241.360000000000;252.460000000000];

Eir=zeros(i, 1);
for j = 1:i
    lowerLimit = 0;
    upperLimit = Eimax(j);
    Eir(j) =lowerLimit + (upperLimit - lowerLimit) * rand;%用户剩余能量
end
%随机生成的一组固定值
% Eir=[1.91783813119677;0.390269065790208;2.14148788541900;1.31042881847589;0.385938071211341;1.40876105134416;2.40419265292165;0.334357805226122;0.178407606497071;0.756375716985362;1.44320703740113;1.32290475787461;1.79643887122073;0.0410090026139308;1.59093207957026;1.79294450230193;0.332468167835339;1.71543307841784;0.467232631134201;1.83827032098126;1.02309219553756;1.19100970611502;0.547344129358361;0.655655353964088;2.99242032097231;2.42213574137640;1.61350773826152;0.199581067587168;0.876396118023579;2.56520254111235;0.654231168385180;1.25555224325803;1.84480169776120;0.222447762073140;0.184249584401747;0.435293668106352;1.04021422212188;1.25803521631682;1.48085591413152;1.42510192303416;0.519048900487605;2.06557553098500;2.45303258715643;0.555136948581809;0.0216155689021668;2.49106418140422;0.269224224573338;0.334939577425196;0.592380104397376;3.16152287058740;1.11423083956957;1.49942802931410;1.01631120412553;1.39109180673842;0.409659245186529;1.69747553368859;0.194827186827568;2.89410361650041;1.45022258189796;1.24671187226332;1.77990492893319;0.137614041609100;0.627907271688175;1.62955534710431;2.02934321439881;1.10226339510295;1.07868405515515;1.35961499858931;0.296412268584433;0.886652579826379;0.173128707297850;0.494883191500592;1.89114039842625;0.168060160967333;0.497114550011234;1.14459100089975;1.00736436804100;0.315031262740157;1.05726553484619;1.82198002562626;2.48672205117584;0.272326624463350;1.18159842402127;0.347432874770641;0.665813451450770;1.28735314965804;3.08896499185316;0.383670876522245;1.29535295779598;1.33141366175600;0.269215860530422;1.65987237493593;1.82546587114956;1.77419095235381;3.13873050807606;1.34723746954957;1.93500009798321;1.53186766852613;1.92696926394960;0.439846941450109;0.0638530204921729;0.529392004888786;1.44457345782684;1.06441247367927;2.29437056735814;1.14830000803371;1.25919279393965;0.281692768935828;1.46033033401774;0.876860456034060;0.209642388180788;2.16763764984104;2.51954316997296;2.60775082136950;0.983667006317001;2.25688045348092;1.01497347667263;0.936691702348137;0.698759580132580;2.01344377787266;1.70987510710864;0.873040324583665;1.18721634602686;0.183912173205202;0.931088015403803;3.16388028209639;1.60008176305835;2.25161720801348;1.60610665263741;0.945895971156083;0.572388264636228;1.16905305944301;1.15459614381134;0.615962985665277;0.703342293894608;0.372527210353599;1.17448582057203;1.52489418348682;1.73062976322884;1.74657879377338];
% user_pos(:,9)=Eir;
Eir= round( Eir, 2);%保留两位小数
Eir=[0.370000000000000;2.16000000000000;0.600000000000000;1.49000000000000;0.750000000000000;0.320000000000000;2.05000000000000;0.520000000000000;0.720000000000000;1.90000000000000;0.120000000000000;0.270000000000000;1.89000000000000;2.04000000000000;0.900000000000000;1.35000000000000;1.99000000000000;0.920000000000000;1.48000000000000;0.590000000000000;0.700000000000000;1.07000000000000;0.0100000000000000;0.520000000000000;1.14000000000000;0.0500000000000000;0.190000000000000;0.490000000000000;0.550000000000000;0.540000000000000;0.950000000000000;0.410000000000000;0.830000000000000;0.770000000000000;1.21000000000000;0.320000000000000;0.740000000000000;0.170000000000000;0.650000000000000;0.750000000000000;0.330000000000000;1.43000000000000;1.41000000000000;0.190000000000000;0.0800000000000000;3.18000000000000;1.85000000000000;0.780000000000000;0.100000000000000;1;0.800000000000000;0.360000000000000;0.980000000000000;1.81000000000000;0.660000000000000;0.260000000000000;0.210000000000000;1.90000000000000;1.35000000000000;0.280000000000000;0.220000000000000;0.540000000000000;2.27000000000000;2.11000000000000;0.0200000000000000;0.670000000000000;0.460000000000000;2.71000000000000;0.0900000000000000;1.56000000000000;0.390000000000000;0.430000000000000;1.38000000000000;2.79000000000000;0.820000000000000;1.32000000000000;0.730000000000000;1.76000000000000;0.610000000000000;0.590000000000000;0.860000000000000;1.80000000000000;0.730000000000000;1.19000000000000;0.300000000000000;1.82000000000000;0.660000000000000;1.22000000000000;1.20000000000000;1.14000000000000;2.14000000000000;1.03000000000000;1.61000000000000;0.320000000000000;1.76000000000000;1.87000000000000;0.0300000000000000;0.960000000000000;2.64000000000000;2.73000000000000;2.25000000000000;0.980000000000000;0.0500000000000000;0.980000000000000;1.61000000000000;0.730000000000000;0.130000000000000;1.83000000000000;0.0500000000000000;0.350000000000000;3.37000000000000;0.800000000000000;0.310000000000000;0.480000000000000;1.26000000000000;0.130000000000000;0.580000000000000;1.09000000000000;1.57000000000000;0.900000000000000;1.17000000000000;0.600000000000000;1.91000000000000;0.110000000000000;3.22000000000000;0.780000000000000;0.430000000000000;1.69000000000000;1.40000000000000;1.22000000000000;1.72000000000000;0.410000000000000;1.19000000000000;1.12000000000000;0.0600000000000000;1.76000000000000;2.15000000000000;1.63000000000000;1.14000000000000;0.540000000000000];

%计算每个用户的优先级
faie=0.5;
fait=0.5;
for j=1:i
detai(j)=faie*exp(-Eir(j)/Eimax(j))+fait*exp(-betai(j)*Ti(i)/T(j));%每个用户优先级
user_pos(j,4)=detai(j);%用户优先级存在用户第4列 数越小优先级越高
end
user_pos = sortrows(user_pos, 4); 
%% k-means++ 第一步即选取一个初始的聚类中心。

data = user_pos(:,1:2);
[num_rows, num_columns] = size(data);
num_clusters = 12;% 设置聚类的个数
K=num_clusters;%簇的个数 总区域个数
center_indices = randi(num_rows, 1, 1);
distances = sum((data - data(center_indices,:)).^2, 2);

for i = 2:num_clusters
    min_distances = min(distances, [], 2);
    probabilities = min_distances / sum(min_distances);
    center_indices(i) = randsample(num_rows, 1, true, probabilities);  
    new_distances = sum((data - data(center_indices(i),:)).^2, 2); 
    distances = min(distances, new_distances);
end


for i = 1:user_num
    user_coord = data(i, 1:2); 
    min_dist = Inf; 
    for j = 1:num_clusters
        dist = norm(user_coord - data(center_indices(j), 1:2));
        if dist < min_dist
            min_dist = dist;
            user_pos(i,5) = j; 
        end
    end
end


     cluster_features=zeros(num_clusters,4);  
     
    for j=1:num_clusters
         cluster_features(j,1:4) = cluster_features(j,1:4)+ sum(user_pos(user_pos(:,5) == j,1:4),1);
    end
    
    for j=1:num_clusters
         cluster_features_new(j,1:4) = cluster_features(j,1:4)/size(user_pos(user_pos(:,5) == j),1);
    end       
    

center_coord=data(center_indices,:);%Kmeans++聚类中心坐标
while ~isequal(center_coord, cluster_features_new(:,1:2))
    center_coord = cluster_features_new(:,1:2);%
    % 将每个用户划分到离其最近的聚类中心中，并计算每个组的特征集
    for i = 1:user_num
        user_coord = data(i, 1:2); 
        min_dist =200; 
        for j = 1:num_clusters
            dist = norm(user_coord -center_coord (j,:)) ; 
            if dist < min_dist
                min_dist = dist;
                user_pos(i,5) = j; 
            end
        end
    end
          cluster_features_new=zeros(num_clusters,4);
       for j = 1:num_clusters
            cluster_features_new(j,1:4) = cluster_features_new(j,1:4)+ sum(user_pos(user_pos(:,5) == j,1:4),1);
       end
       for j = 1:num_clusters   
            cluster_features_new(j,1:4) = cluster_features_new(j,1:4)/size(user_pos(user_pos(:,5) == j),1);  
      end  
end
%   cluster_features_new=[253.428571428571,419.071428571429,0,0.627277620270704;77.4444444444444,25.7777777777778,0,0.625674712415845;65,431.400000000000,0,0.698563794682532;257.700000000000,71.3000000000000,0,0.670077354679191;125.533333333333,261.733333333333,0,0.649047336912700;412.714285714286,58.7142857142857,0,0.723878612544415;73.8571428571429,118.714285714286,0,0.739910867109316;448.666666666667,448.916666666667,0,0.630245696993875;385.357142857143,363.285714285714,0,0.722310835654142;252.538461538462,260.384615384615,0,0.720557059327765;30.5000000000000,297.666666666667,0,0.678824402350532;413.062500000000,198.437500000000,0,0.702726226669907];
%      center_coord=  cluster_features_new(:,1:2);  
% %      user_pos(:,5)=[6;4;2;1;1;8;3;1;1;4;8;5;2;12;6;12;11;8;5;12;1;5;9;2;4;8;8;8;3;6;1;5;9;2;3;7;12;11;5;1;4;12;7;5;12;10;1;5;5;5;8;2;9;6;4;5;2;3;12;9;1;9;6;8;4;8;12;11;10;7;10;1;2;1;5;9;8;10;10;2;5;9;6;5;11;1;12;12;10;6;10;12;3;3;2;3;10;6;9;4;8;11;9;8;7;1;10;9;10;10;5;10;3;5;3;4;1;4;11;6;6;4;9;7;9;12;6;7;12;12;6;12;9;6;3;7;12;9;6;10];
%      user_pos(:,5)=[12;9;9;11;3;8;6;3;11;1;1;10;7;9;4;6;2;9;8;5;6;10;5;6;12;2;5;2;7;5;6;6;5;12;8;8;3;2;1;1;4;8;4;6;9;10;5;6;4;1;5;12;5;5;9;12;1;4;6;6;7;3;9;5;10;10;3;4;12;12;6;1;12;12;1;4;6;3;11;12;9;2;10;2;1;5;2;3;5;12;4;11;5;5;10;9;7;12;12;8;10;8;8;1;8;9;12;8;12;11;9;3;10;1;10;12;6;8;1;4;3;2;10;10;1;11;9;5;7;9;1;8;3;6;4;2;7;9;7;10];

%%%%%用于140用户4个无人机
cluster_features_new= [97.5625000000000,52.3750000000000,0;41.9000000000000,400.200000000000,0;339.272727272727,36,0;455.857142857143,80.2857142857143,0;424.666666666667,294.666666666667,0;160.333333333333,425.111111111111,0;276.700000000000,164.600000000000,0;435.625000000000,436.062500000000,0;199.363636363636,259.363636363636,0;77.1428571428571,245.928571428571,0;302.058823529412,383.235294117647,0;419.100000000000,181.400000000000,0];  
  center_coord=  cluster_features_new(:,1:2);  
  user_pos(:,5)=[12;5;11;2;2;8;3;2;2;11;11;7;1;5;1;4;1;8;8;10;4;11;10;3;5;1;10;1;10;10;3;4;9;7;8;8;6;1;11;6;3;8;7;4;5;11;9;4;3;11;10;5;10;9;5;12;11;3;3;3;10;2;8;10;9;9;2;3;5;12;3;11;12;5;6;7;4;6;2;12;11;1;7;1;6;10;1;2;9;12;7;10;9;6;11;5;1;7;12;8;7;8;8;11;8;8;12;8;12;10;11;2;9;11;7;12;3;8;11;1;2;1;9;9;6;10;11;10;1;8;6;8;6;4;7;1;1;11;1;9];
  
  % cluster_features_new=[305,342.666666666667,0,0.751567194691341;265,70.0909090909091,0,0.724319825042936;420.666666666667,336.666666666667,0,0.679561031347508;77.1428571428571,245.928571428571,0,0.715360420494596;81.6428571428571,51.9285714285714,0,0.756527642884267;465,445.444444444444,0,0.736166998598986;413.062500000000,198.437500000000,0,0.722250646091013;58.8461538461539,402.153846153846,0,0.712903347749367;212.230769230769,237.461538461538,0,0.754259911510519;207.900000000000,427.800000000000,0,0.762093869379622;371.666666666667,434.444444444444,0,0.698608664637014;418.461538461538,58.7692307692308,0,0.688829362829361];        
% center_coord=  cluster_features_new(:,1:2); 
% user_pos(:,5)=[7;3;11;8;8;6;12;8;8;11;1;9;5;3;2;12;5;11;6;4;12;1;4;12;7;5;4;5;4;4;12;12;9;7;11;6;10;5;1;10;2;6;2;12;3;1;9;12;2;10;4;7;4;9;3;7;11;2;2;12;4;8;11;4;9;9;8;2;7;7;12;10;7;7;10;2;12;8;8;7;1;5;1;5;10;4;5;8;9;7;2;4;9;8;1;3;5;7;7;6;9;11;6;1;11;3;7;6;7;4;1;8;9;1;9;7;12;6;10;2;8;5;9;10;10;4;1;4;5;11;10;6;8;12;2;5;5;1;5;9];

newColumn = (1:num_clusters)';
cluster_features_new = [  cluster_features_new , newColumn];

newColumn = (1:num_clusters)';
center_coord_1 = [center_coord , newColumn];